var ConditionalSelect=new Class({Binds:["update"],Implements:Options,options:{includeBlankOption:false,blankOptionLabel:"-"},initialize:function(b,c,d,a){this.setOptions(a);this.element=$(b);this.parent=$(c);this.data=d;this.parent.addEvent("change",function(e){this.update(e.target)}.bind(this));window.addEvent("ajaxready",function(e){this.update(e.target)}.bind(this));this.update()},update:function(d){if(d){this.parent=$(d)}this.element.set("html","");if(this.options.includeBlankOption){var c=new Element("option",{value:""});c.set("html",this.options.blankOptionLabel);this.element.appendChild(c)}var e=0;var b=new Array();for(i=0;i<this.parent.options.length;i++){if(this.parent.options[i].selected){b[e]=this.parent.options[i].value;e++}}for(s=0;s<b.length;s++){currentSelect=b[s];if(this.data[currentSelect]){var a=this.element;var f=false;if(b.length>1){f=true;a=new Element("optgroup",{label:(this.parent.getFirst("[value=ch]").get("text")?this.parent.getFirst(("[value="+currentSelect+"]")).get("text"):currentSelect)})}for(i=0;i<this.data[currentSelect].length;i++){var c=new Element("option",{value:this.data[currentSelect][i]["value"]});c.set("html",this.data[currentSelect][i]["label"]);if(this.data[currentSelect][i]["default"]=="true"){c.selected=true}a.appendChild(c)}if(f){this.element.appendChild(a)}}}if(this.element.options.length==0){this.element.options[0]=new Option("-","")}this.element.fireEvent("change",[this.element,this.parent,this.data])}});