var ConditionalSelect=new Class({Binds:["update","generateOptions"],Implements:Options,options:{includeBlankOption:false,blankOptionLabel:"-"},initialize:function(e,t,n,r,i){this.setOptions(i);this.element=$(e);this.parent=$(t);this.data=n;this.values=new Hash(r);this.parent.addEvent("change",function(){this.update(this.parent)}.bind(this));window.addEvent("ajaxready",function(){this.update(this.parent)}.bind(this));this.update()},update:function(e){if(e){this.parent=$(e)}this.element.set("html","");if(this.options.includeBlankOption){var t=new Element("option",{value:""});t.set("html",this.options.blankOptionLabel);this.element.appendChild(t)}var n=[];for(i=0;i<this.parent.options.length;i++){if(this.parent.options[i].selected){n.push(this.parent.options[i].value)}}for(s=0;s<n.length;s++){currentSelect=n[s];if(this.data[currentSelect]){var r=this.element;var o=false;if(n.length>1){o=true;r=new Element("optgroup",{label:this.parent.getFirst("[value="+currentSelect+"]").get("text")?this.parent.getFirst("[value="+currentSelect+"]").get("text"):currentSelect})}if(Object.prototype.toString.call(this.data[currentSelect])!=="[object Array]"){var u=o?r.label+" â€“ ":"";o=false;for(k in this.data[currentSelect]){r=new Element("optgroup",{label:u+k});r=this.generateOptions(this.data[currentSelect][k],r);this.element.appendChild(r)}}else{r=this.generateOptions(this.data[currentSelect],r)}if(o){this.element.appendChild(r)}}}if(this.element.options.length==0){this.element.options[0]=new Option("-","")}this.element.fireEvent("change",[this.element,this.parent,this.data])},generateOptions:function(e,t){for(i=0;i<e.length;i++){var n=new Element("option",{value:e[i]["value"]});n.set("html",e[i]["label"]);if(!this.values&&e[i]["default"]=="true"||this.values&&e[i]["value"]&&this.values.hasValue(e[i]["value"].toString())){n.selected=true}t.appendChild(n)}return t}})