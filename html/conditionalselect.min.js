var ConditionalSelect=new Class({Binds:["update","generateOptions"],Implements:Options,options:{includeBlankOption:false,blankOptionLabel:"-"},initialize:function(c,d,e,a,b){this.setOptions(b);this.element=$(c);this.parent=$(d);this.data=e;this.values=new Hash(a);this.parent.addEvent("change",function(){this.update(this.parent)}.bind(this));window.addEvent("ajaxready",function(){this.update(this.parent)}.bind(this));this.update()},update:function(e){if(e){this.parent=$(e)}this.element.set("html","");if(this.options.includeBlankOption){var d=new Element("option",{value:""});d.set("html",this.options.blankOptionLabel);this.element.appendChild(d)}var c=[];for(i=0;i<this.parent.options.length;i++){if(this.parent.options[i].selected){c.push(this.parent.options[i].value)}}for(s=0;s<c.length;s++){currentSelect=c[s];if(this.data[currentSelect]){var b=this.element;var f=false;if(c.length>1){f=true;b=new Element("optgroup",{label:(this.parent.getFirst(("[value="+currentSelect+"]")).get("text")?this.parent.getFirst(("[value="+currentSelect+"]")).get("text"):currentSelect)})}if(Object.prototype.toString.call(this.data[currentSelect])!=="[object Array]"){var a=f?(b.label+" â€“ "):"";f=false;for(k in this.data[currentSelect]){b=new Element("optgroup",{label:(a+k)});b=this.generateOptions(this.data[currentSelect][k],b);this.element.appendChild(b)}}else{b=this.generateOptions(this.data[currentSelect],b)}if(f){this.element.appendChild(b)}}}if(this.element.options.length==0){this.element.options[0]=new Option("-","")}this.element.fireEvent("change",[this.element,this.parent,this.data])},generateOptions:function(c,a){for(i=0;i<c.length;i++){var b=new Element("option",{value:c[i]["value"]});b.set("html",c[i]["label"]);if((!this.values&&c[i]["default"]=="true")||(this.values&&c[i]["value"]&&this.values.hasValue(c[i]["value"].toString()))){b.selected=true}a.appendChild(b)}return a}});